---
- stat: path=/usr/local/bin/vim
  register: vim_exec

- debug: var=vim_exec

- set_fact:
    need_install: "{{ not vim_exec.stat.exists }}"

- debug: var=need_install

- include: "install-debian.yml"
  when: ansible_distribution == 'Debian'

- include: "install-ubuntu.yml"
  when: ansible_distribution == 'Ubuntu' or ansible_os_family == "\"elementary\""

- include: "install-fedora.yml"
  when: ansible_distribution == 'Fedora'

- include: "install-centos.yml"
  when: ansible_distribution == 'CentOS'

- include: "install-osx.yml"
  when: ansible_distribution == 'MacOSX'

- name: create virtualenv 3
  shell: python3 -m virtualenv neovim-python3
  args:
    chdir: ~/.config/nvim/
    creates: ~/.config/nvim/neovim-python3/bin/python

- name: create virtualenv 2
  shell: python2 -m virtualenv neovim-python2
  args:
    chdir: ~/.config/nvim/
    creates: ~/.config/nvim/neovim-python2/bin/python


- name: pip3 install [neovim nvr]
  pip: name={{ item }} virtualenv=~/.config/nvim/neovim-python3  virtualenv_command='python3 -m virtualenv'
  with_items:
    - neovim
    - neovim-remote

- name: pip2 install [neovim]
  pip: name={{ item }} virtualenv=~/.config/nvim/neovim-python2  virtualenv_command='python2 -m virtualenv'
  with_items:
    - neovim

- name: pip install [autopep8, flake8]
  pip: name={{ item }}
  become: true
  with_items:
    - autopep8
    - flake8
    - websocket-client
    - sexpdata

- git: repo=https://github.com/gmarik/vundle.git
       dest=~/.vim/bundle/vundle
       depth=1
       force=yes

- git: repo=https://github.com/powerline/powerline
       dest=~/.powerline
       depth=1

- git: repo=https://github.com/SpaceVim/SpaceVim
       dest=~/SpaceVim
  when: programming == true

- name: download vim-plug
  get_url: url=https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim dest=/tmp/plug.vim

- file: path="{{ item }}" state=directory recurse=yes
  with_items:
    - "~/.vim/autoload/"
    - "~/.config/nvim/autoload/"

- copy: src=/tmp/plug.vim dest={{ item }} remote_src=yes
  with_items:
    - "~/.vim/autoload/plug.vim"
    - "~/.config/nvim/autoload/plug.vim"

- name: clone evervim
  git: repo=https://github.com/LER0ever/EverVim
       dest="~/EverVim" depth=1 force=yes
  when: programming == true

- name: download ripgrep.tar.gz
  get_url: url={{ ripgrep_url }} dest=/tmp/ripgrep.tar.gz

- name: unarchive ripgrep.tar.gz
  unarchive: src="/tmp/ripgrep.tar.gz" dest="/tmp"

- file: path="~/.config/nvim/bin" state="directory"

- copy: src='dict.sh' dest='~/.config/nvim/bin' mode=0755

- copy: src="/tmp/ripgrep-0.9.0-x86_64-unknown-linux-musl/rg" dest="~/.config/nvim/bin" mode=0555
